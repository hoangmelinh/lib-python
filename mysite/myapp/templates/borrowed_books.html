{% load static %}
<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <title>Danh sách mượn sách - PTIT ELIB</title>
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/borrowed_books.css' %}">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
  </head>
  <body>
    <header class="fixed-header">
      <!-- Header Top -->
      <div class="header-top">
        <div class="header-top-left">
          <a href="#" class="lang-link">VI</a> | <a href="#" class="lang-link">EN</a>
          <a href="https://www.facebook.com/HocvienPTIT/?locale=vi_VN" class="social-link"><i class="lni lni-facebook"></i></a>
          <a href="https://www.youtube.com/@PChannels" class="social-link"><i class="lni lni-youtube"></i></a>
        </div>
        <div class="header-top-right">
          <a href="https://ptit.edu.vn/" class="portal-link">Cổng thông tin</a>
        </div>
      </div>
      <!-- Header Bottom -->
      <div class="header-bottom">
        <div class="logo">
          <div class="logo-wrapper">
            <img src="{% static 'images/download-logo-vector-hoc-vien-cong-nghe-buu-chinh-vien-thong-mien-phi.jpg' %}" alt="Logo PTIT" class="logo-img">
            <div class="logo-text">
              <h1 class="ten">HỌC VIỆN CÔNG NGHỆ BƯU CHÍNH VIỄN THÔNG</h1>
              <p class="subtitle">Posts and Telecommunications Institute of Technology</p>
            </div>
          </div>
        </div>
        <nav class="main-nav">
          <ul class="menu">
            <li><a href="{% url 'home' %}" class="nav-link">Trang chủ</a></li>
            <li><a href="{% url 'intro' %}" class="nav-link">Giới thiệu</a></li>
            <li><a href="{% url 'borrowed_books' %}" class="nav-link active">Danh sách mượn</a></li>
            <li class="auth-links">
              {% if request.user.is_authenticated %}
                <span class="welcome-text">Xin chào, {{request.user}}</span>
                <a href="{% url 'login' %}" class="logout-btn">Đăng Xuất</a>
              {% else %}
                <a href="{% url 'login' %}" class="login-btn">Đăng Nhập</a>
                <a href="{% url 'register' %}" class="register-btn">Đăng Ký</a>
              {% endif %}
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <main>
      <section style="margin-top: 12rem; display: flex; justify-content: center; align-items: flex-start; min-height: 70vh;">
        <div style="width: 100%; max-width: 800px;">
          <h2 class="mb-4 fw-semibold text-center">Sách đã mượn</h2>
          {% if borrowed_books %}
          <div class="d-flex flex-column gap-3" style="align-items: stretch;">
              {% for record in borrowed_books %}
                  {% if record.returned_at is None %}
                  <div href = class="card borrowed-book-card border-0 shadow-sm p-4" style="border-radius: 12px; background-color: #f8f9fa;">
                      <div class="d-flex align-items-start">
                          <img src="{{ record.book.image.url }}" alt="Bìa sách" class="borrowed-book-cover rounded" style="width: 100px; height: 140px; object-fit: cover; margin-right: 20px;">
                          <div class="flex-grow-1">
                              <h5 class="mb-2 borrowed-book-title">{{ record.book.title }}</h5>
                              <div class="borrowed-book-info mb-1">
                                  <span class="info-label">Tác giả:</span>
                                  <span class="info-value">{{ record.book.author }}</span>
                              </div>
                              <div class="borrowed-book-info mb-2">
                                  <span class="info-label">Ngày mượn:</span>
                                  <span class="info-value">{{ record.borrowed_at|date:"d/m/Y" }}</span>
                              </div>
                              <form action="{% url 'return_book' record.id %}" method="post" class="mt-auto">
                                  {% csrf_token %}
                                  <button type="submit" class="btn btn-outline-danger rounded-pill shadow px-4 py-2">
                                      <i class="bi bi-arrow-return-left me-2"></i> Trả sách
                                  </button>
                              </form>
                          </div>
                      </div>
                  </div>
                  {% endif %}
              {% endfor %}
          </div>
          {% else %}
              <div class="alert alert-secondary text-center" role="alert">
                  <i class="bi bi-book"></i> Bạn chưa mượn quyển sách nào.
              </div>
          {% endif %}
        </div>
      </section>
    </main>

    <footer style="background-color: #B22222; color: white; padding: 2rem 0; margin-top: 2rem;">
      <div class="container">
        <div class="row">
          <div class="col-12 text-center mb-4">
            <h5 class="text-uppercase fw-bold" style="font-size: 1.5rem;">
              TRUNG TÂM THÔNG TIN THƯ VIỆN – HỌC VIỆN CÔNG NGHỆ BƯU CHÍNH VIỄN THÔNG
            </h5>
          </div>
          <div class="col-md-4 mb-3">
            <div class="px-3">
              <p class="mb-4">
                <strong>Trụ sở chính:</strong><br>
                122 Hoàng Quốc Việt, Q.Cầu Giấy, Hà Nội
              </p>
              <p class="mb-2">
                <strong>Cơ sở đào tạo tại Hà Nội:</strong><br>
                Km10, Đường Nguyễn Trãi, Q.Hà Đông, Hà Nội
              </p>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="px-3">
              <p class="mb-4">
                <strong>Học viện cơ sở tại TP Hồ Chí Minh:</strong><br>
                11 Nguyễn Đình Chiểu, P.Đa Kao, Q.1 TP Hồ Chí Minh
              </p>
              <p class="mb-2">
                <strong>Cơ sở đào tạo tại TP Hồ Chí Minh:</strong><br>
                Đường Man Thiện, P.Hiệp Phú, Q.9 TP Hồ Chí Minh
              </p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="map-container">
              <iframe
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1862.6453264514646!2d105.78610757722628!3d20.980983103220105!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3135accdd8a1ad71%3A0xa2f9b16036648187!2zSOG7jWMgdmnhu4duIEPDtG5nIG5naOG7hyBCxrB1IGNow61uaCB2aeG7hW4gdGjDtG5n!5e0!3m2!1svi!2s!4v1730383925525!5m2!1svi!2s"
                width="100%"
                height="200"
                style="border: 0"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade">
              </iframe>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>